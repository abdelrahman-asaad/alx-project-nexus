<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
  <meta charset="UTF-8">
  <title>Invoices</title>
</head>
<body>
  <h2>Invoices</h2>
  <button onclick="logout()">Logout</button>

  <!-- üîπ ÿ≤ÿ±ÿßÿ± ÿßŸÑÿØÿßÿ¥ÿ®Ÿàÿ±ÿØ ŸáŸÜÿ∏Ÿáÿ±Ÿá ŸÑŸà ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿßŸÜÿ¨ÿ± ÿ£Ÿà ÿ£ŸàŸÜÿ± -->
  <button id="dashboardBtn" onclick="location.href='/api/dashboard/'">üè† Dashboard</button>

  <button onclick="window.location.href='/invoices/create/'">‚ûï Create New Invoice</button>

  <div id="invoiceList"></div>
  <div id="pagination"></div>

<script src="{% static 'accounts/js/auth.js' %}?v=2"></script>
  <script>
    // üîπ ÿØÿßŸÑÿ© ŸÑÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä Ÿàÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ≤ÿ±ÿßÿ±
    async function getUserInfo() {
      try {
        const res = await authFetch("/api/accounts/me/");
        if (!res.ok) {
          console.error("Failed to fetch user info");
          return;
        }

        const user = await res.json();
        console.log("Logged in user:", user);

        // ‚úÖ ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ≤ÿ±ÿßÿ± ŸÑŸà ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ Manager ÿ£Ÿà Owner
        if (user.role === "manager" || user.role === "owner") {
          const dashBtn = document.getElementById("dashboardBtn");
          dashBtn.style.display = "inline-block";
          dashBtn.addEventListener("click", () => {
            window.location.href = "/dashboard/";
          });
        }
      } catch (error) {
        console.error("Error fetching user info:", error);
      }
    }

    // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑÿØÿßŸÑÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
    getUserInfo();

    // =====================================
    // üîπ ŸÜŸÅÿ≥ ŸÉŸàÿØ ÿßŸÑŸÅŸàÿßÿ™Ÿäÿ± ÿ®ÿ™ÿßÿπŸÉ ÿ®ÿßŸÑÿ∏ÿ®ÿ∑
    // =====================================
    async function fetchInvoices(page = 1) {
      const res = await authFetch(`/api/invoices/?page=${page}`);
      const data = await res.json();

      const invoiceList = document.getElementById("invoiceList");
      invoiceList.innerHTML = "";
      data.results.forEach(inv => {
        invoiceList.innerHTML += `
          <p><b>ID:</b> ${inv.id} | Client: ${inv.client.name} | Total: ${inv.total_amount} | Status: ${inv.status}</p>
        `;
      });

      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";

      if (data.previous) {
        pagination.innerHTML += `<button onclick="fetchInvoices(${page - 1})">‚¨Ö Prev</button>`;
      }
      if (data.next) {
        pagination.innerHTML += `<button onclick="fetchInvoices(${page + 1})">Next ‚û°</button>`;
      }
    }

    fetchInvoices();
    
  </script>
</body>
</html>

